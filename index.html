<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>30-DAYS BYE-BYE M·ª† B·ª§NG</title>
  <!-- Chart.js CDN -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root{
      --pink:#ef5da8;   /* H∆∞∆°ng */
      --blue:#4f46e5;   /* Th√πy  */
      --green:#16a34a;  /* Li√™n  */
      --bg:#0b0f19; --card:#111729; --muted:#9aa4b2; --text:#e5e7eb; --accent:#22c55e;
      --grid:#1b2336; --border:#2b3650;
    }
    *{box-sizing:border-box}
    body{margin:0;background:linear-gradient(180deg,#0b0f19 0%,#0a0e17 100%);color:var(--text);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"Apple Color Emoji","Segoe UI Emoji";}
    .wrap{max-width:1100px;margin:32px auto;padding:0 16px;}
    h1{font-size:28px;margin:0 0 6px}
    .sub{color:var(--muted);font-size:14px;margin-bottom:20px}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid{grid-template-columns:1.2fr .8fr}}
    .card{background:var(--card);border:1px solid var(--border);border-radius:14px;padding:16px;box-shadow:0 10px 30px rgba(0,0,0,.2)}
    .card h2{margin:0 0 12px;font-size:18px}
    .lb{display:flex;flex-direction:column;gap:10px}
    .row{display:flex;align-items:center;gap:12px;background:#0e1630;border:1px solid var(--border);padding:10px;border-radius:12px}
    .medal{width:28px;height:28px;border-radius:50%;display:grid;place-items:center;font-weight:700}
    .name{min-width:76px}
    .cnt{margin-left:auto;font-variant-numeric:tabular-nums}
    .bar{width:100%;height:10px;background:var(--grid);border-radius:999px;overflow:hidden}
    .bar>span{display:block;height:100%}
    .pink{color:var(--pink)} .blue{color:var(--blue)} .green{color:var(--green)}
    .b-pink{background:var(--pink)} .b-blue{background:var(--blue)} .b-green{background:var(--green)}
    .controls{display:flex;gap:10px;flex-wrap:wrap;margin-top:10px}
    button{border:1px solid var(--border);background:#0f1732;color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer;font-weight:600}
    button:hover{filter:brightness(1.1)}
    .btn-pink{border-color:color-mix(in oklab, var(--pink), white 20%);background:color-mix(in oklab, var(--pink), black 80%)}
    .btn-blue{border-color:color-mix(in oklab, var(--blue), white 20%);background:color-mix(in oklab, var(--blue), black 80%)}
    .btn-green{border-color:color-mix(in oklab, var(--green), white 20%);background:color-mix(in oklab, var(--green), black 80%)}
    .pill{font-size:12px;color:var(--muted)}
    table{width:100%;border-collapse:separate;border-spacing:0 8px}
    th,td{text-align:center;padding:8px;border-top:1px solid var(--border);border-bottom:1px solid var(--border)}
    tbody tr{background:#0f1732}
    th:first-child,td:first-child{border-left:1px solid var(--border);border-top-left-radius:10px;border-bottom-left-radius:10px;text-align:left}
    th:last-child,td:last-child{border-right:1px solid var(--border);border-top-right-radius:10px;border-bottom-right-radius:10px}
    .daycell{cursor:pointer;user-select:none}
    .daycell.done{background:#14233f;box-shadow:inset 0 0 0 1px #28406f}
    .legend{display:flex;gap:12px;flex-wrap:wrap;color:var(--muted);font-size:13px;margin-top:8px}
    .dot{width:10px;height:10px;border-radius:50%;display:inline-block;margin-right:6px;vertical-align:middle}
    .foot{margin-top:14px;display:flex;gap:8px;flex-wrap:wrap}
    .muted{color:var(--muted)}
    .today{font-weight:700}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>30-DAYS BYE-BYE M·ª† B·ª§NG</h1>
    <div class="sub">Th·ª≠ th√°ch 30 ng√†y ‚Ä¢ Th√†nh vi√™n: <b class="pink">H∆∞∆°ng</b>, <b class="blue">Th√πy</b>, <b class="green">Li√™n</b> ‚Ä¢ <span id="today" class="today"></span></div>

    <div class="grid">
      <!-- LEFT: Leaderboard + B·∫£ng 30 ng√†y -->
      <div class="card">
        <h2>üèÜ Leaderboard (x·∫øp theo s·ªë ng√†y ‚úÖ)</h2>
        <div id="leaderboard" class="lb"></div>

        <div class="controls">
          <button class="btn-pink" onclick="checkin('Huong')">‚úÖ Check-in h√¥m nay: H∆∞∆°ng</button>
          <button class="btn-blue" onclick="checkin('Thuy')">‚úÖ Check-in h√¥m nay: Th√πy</button>
          <button class="btn-green" onclick="checkin('Lien')">‚úÖ Check-in h√¥m nay: Li√™n</button>
          <span class="pill">M·∫πo: b·∫°n c√≥ th·ªÉ nh·∫•n tr·ª±c ti·∫øp v√†o √¥ ng√†y trong b·∫£ng ƒë·ªÉ b·∫≠t/t·∫Øt ‚úÖ.</span>
        </div>

        <h2 style="margin-top:18px">üìÖ B·∫£ng chi ti·∫øt 30 ng√†y</h2>
        <div class="legend">
          <span><i class="dot" style="background:var(--pink)"></i>H∆∞∆°ng</span>
          <span><i class="dot" style="background:var(--blue)"></i>Th√πy</span>
          <span><i class="dot" style="background:var(--green)"></i>Li√™n</span>
          <span class="muted">‚Ä¢ √î c√≥ vi·ªÅn ƒë·∫≠m = ƒë√£ ho√†n th√†nh</span>
        </div>
        <div style="overflow-x:auto;margin-top:8px">
          <table id="daysTable"></table>
        </div>

        <div class="foot">
          <button onclick="resetAll()">üîÅ Reset to√†n b·ªô</button>
          <button onclick="exportData()">‚¨áÔ∏è Xu·∫•t JSON</button>
          <label>
            <input type="file" accept="application/json" style="display:none" id="importFile" />
            <button onclick="document.getElementById('importFile').click()">‚¨ÜÔ∏è Nh·∫≠p JSON</button>
          </label>
          <span class="muted">D·ªØ li·ªáu l∆∞u t·ª± ƒë·ªông trong tr√¨nh duy·ªát (localStorage).</span>
        </div>
      </div>

      <!-- RIGHT: Chart + Progress -->
      <div class="card">
        <h2>üìä Bi·ªÉu ƒë·ªì c·ªôt & üìà Ti·∫øn ƒë·ªô</h2>
        <canvas id="barChart" height="200" style="background:#0e1630;border-radius:12px;border:1px solid var(--border)"></canvas>

        <div id="progressWrap" style="margin-top:16px;display:flex;flex-direction:column;gap:10px"></div>
      </div>
    </div>
  </div>

  <script>
    // ====== DATA MODEL ======
    const KEY = "30days-bellyfat-challenge-v1";
    const members = [
      { id:"Huong", name:"H∆∞∆°ng", color:"var(--pink)"},
      { id:"Thuy",  name:"Th√πy",  color:"var(--blue)"},
      { id:"Lien",  name:"Li√™n",  color:"var(--green)"}
    ];
    const DAYS = 30;

    function initState(){
      const saved = localStorage.getItem(KEY);
      if(saved){
        try{ return JSON.parse(saved); }catch(e){}
      }
      // default empty matrix false
      const state = {days: Array.from({length:DAYS},()=>({Huong:false,Thuy:false,Lien:false}))};
      persist(state);
      return state;
    }
    function persist(s){ localStorage.setItem(KEY, JSON.stringify(s)); }

    let state = initState();

    // ====== DATE / TODAY ======
    const now = new Date();
    const dayIndex = 0 + Math.min(DAYS-1, Math.floor((now - new Date(now.getFullYear(), now.getMonth(), now.getDate()))/86400000)); // 0 today start-of-day trick (always 0)
    // We simply treat "Ng√†y 1..30" as slots; Check-in h√¥m nay = slot theo ng√†y th·ª±c c·ªßa th√°ng n·∫øu mu·ªën:
    const todayStr = new Intl.DateTimeFormat('vi-VN',{weekday:'long', day:'2-digit', month:'2-digit', year:'numeric'}).format(now);
    document.getElementById('today').textContent = `H√¥m nay: ${todayStr}`;

    // ====== UI BUILDERS ======
    const lbEl = document.getElementById('leaderboard');
    const tableEl = document.getElementById('daysTable');
    const prWrap = document.getElementById('progressWrap');

    function totalOf(id){
      return state.days.reduce((a,d)=>a+(d[id]?1:0),0);
    }

    function buildLeaderboard(){
      lbEl.innerHTML = "";
      const rows = members
        .map(m => ({...m, total: totalOf(m.id)}))
        .sort((a,b)=>b.total - a.total);

      rows.forEach((m,idx)=>{
        const r = document.createElement('div'); r.className="row";
        const medal = document.createElement('div'); medal.className="medal";
        medal.style.background = idx===0?"#f59e0b":idx===1?"#9ca3af":"#b45309";
        medal.textContent = idx+1;
        const name = document.createElement('div'); name.className="name"; name.innerHTML = `<span style="color:${m.color};font-weight:700">${m.name}</span>`;
        const bar = document.createElement('div'); bar.className="bar";
        const span = document.createElement('span'); span.style.width = (m.total/DAYS*100)+"%"; span.style.background = m.color; bar.appendChild(span);
        const cnt = document.createElement('div'); cnt.className="cnt"; cnt.textContent = `${m.total}/${DAYS} ng√†y`;
        r.append(medal,name,bar,cnt); lbEl.appendChild(r);
      });
    }

    // Progress bars (right column)
    function buildProgress(){
      prWrap.innerHTML="";
      members.forEach(m=>{
        const total = totalOf(m.id);
        const box = document.createElement('div'); box.className="row"; box.style.background="#0e1630";
        const label = document.createElement('div'); label.innerHTML = `<b style="color:${m.color}">${m.name}</b> ‚Ä¢ <span class="muted">${Math.round(total/DAYS*100)}%</span>`;
        const bar = document.createElement('div'); bar.className="bar";
        const span = document.createElement('span'); span.style.width=(total/DAYS*100)+"%"; span.style.background=m.color; bar.appendChild(span);
        box.append(label,bar);
        prWrap.appendChild(box);
      });
    }

    // Table 30 days
    function buildTable(){
      const thead = document.createElement('thead');
      const trh = document.createElement('tr');
      trh.innerHTML = `<th>Ng√†y</th>` + members.map(m=>`<th style="color:${m.color}">${m.name}</th>`).join("");
      thead.appendChild(trh);

      const tbody = document.createElement('tbody');
      for(let d=0; d<DAYS; d++){
        const tr = document.createElement('tr');
        tr.innerHTML = `<td><b>Ng√†y ${d+1}</b></td>`;
        members.forEach(m=>{
          const td = document.createElement('td');
          td.className = "daycell" + (state.days[d][m.id]?" done":"");
          td.dataset.day = d; td.dataset.id = m.id;
          td.style.position="relative";
          td.innerHTML = state.days[d][m.id] ? `‚úÖ` : `<span style="opacity:.4">‚Äî</span>`;
          td.onclick = () => toggleCell(d, m.id);
          tbody.appendChild(tr).appendChild(td);
        });
      }
      tableEl.innerHTML="";
      tableEl.append(thead, tbody);
    }

    function toggleCell(day, id){
      state.days[day][id] = !state.days[day][id];
      persist(state);
      refresh();
    }

    // ====== CHART ======
    let chart;
    function buildChart(){
      const ctx = document.getElementById('barChart');
      const totals = members.map(m=>totalOf(m.id));
      const colors = members.map(m=>getComputedStyle(document.documentElement).getPropertyValue(m.color.replace('var(','').replace(')','')).trim());
      if(chart) chart.destroy();
      chart = new Chart(ctx, {
        type:'bar',
        data:{
          labels: members.map(m=>m.name),
          datasets:[{ label:'S·ªë ng√†y ƒë√£ ‚úÖ', data: totals, backgroundColor: [ 'var(--pink)','var(--blue)','var(--green)' ]}]
        },
        options:{
          responsive:true,
          plugins:{
            legend:{display:false},
            tooltip:{
              callbacks:{ label:(c)=>`${c.parsed.y}/${DAYS} ng√†y` }
            }
          },
          scales:{
            y:{beginAtZero:true, suggestedMax:30, ticks:{color:'#cbd5e1'}, grid:{color:'#233152'}},
            x:{ticks:{color:'#cbd5e1'}, grid:{display:false}}
          }
        }
      });
    }

    // ====== ACTIONS ======
    function checkin(id){
      // auto map "h√¥m nay" v√†o slot theo ng√†y trong th·ª≠ th√°ch:
      // N·∫øu mu·ªën kh√≥a t∆∞∆°ng lai: ch·ªâ cho ph√©p <= ng√†y hi·ªán t·∫°i trong th√°ng ‚Äì t√πy nhu c·∫ßu.
      const d = todayChallengeIndex();
      state.days[d][id] = true;
      persist(state);
      refresh();
      blinkTodayCell(d, id);
    }

    // Day index of challenge based on today's date (1..30 mapped to 0..29)
    function todayChallengeIndex(){
      const dayOfMonth = new Date().getDate();
      return Math.min(DAYS-1, Math.max(0, dayOfMonth-1));
    }

    function blinkTodayCell(d,id){
      const cells = tableEl.querySelectorAll(`td.daycell[data-day="${d}"][data-id="${id}"]`);
      cells.forEach(c=>{
        c.animate([{outline:'2px solid #fff', offset:0},{outline:'0px solid transparent', offset:1}],{duration:600,easing:'ease-out'});
      });
    }

    function resetAll(){
      if(!confirm("X√≥a to√†n b·ªô d·ªØ li·ªáu 30 ng√†y?")) return;
      state = {days: Array.from({length:DAYS},()=>({Huong:false,Thuy:false,Lien:false}))};
      persist(state);
      refresh();
    }

    function exportData(){
      const blob = new Blob([JSON.stringify(state,null,2)], {type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url; a.download = '30days-data.json'; a.click();
      URL.revokeObjectURL(url);
    }

    document.getElementById('importFile').addEventListener('change', (e)=>{
      const file = e.target.files[0]; if(!file) return;
      const rd = new FileReader();
      rd.onload = () => {
        try{
          const obj = JSON.parse(rd.result);
          if(!obj.days || obj.days.length !== DAYS) throw new Error();
          state = obj; persist(state); refresh();
        }catch(_){ alert("T·ªáp kh√¥ng h·ª£p l·ªá."); }
      };
      rd.readAsText(file);
      e.target.value = "";
    });

    function refresh(){
      buildLeaderboard();
      buildProgress();
      buildTable();
      buildChart();
      // highlight today's column header
      const idx = todayChallengeIndex();
      const header = tableEl.querySelector('tbody tr:nth-child('+(idx+1)+') td:first-child');
      if(header){ header.style.background="#13203a"; header.style.fontWeight="700"; }
    }

    // ====== INIT ======
    refresh();
  </script>
</body>
</html>

