<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>30 NGÃ€Y BYE BYE Má»  Bá»¤NG</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
  :root{
    --p1:#ff8fab; --p2:#ffb3c1; --p3:#ffd6a5;
    --bg:#fff7fb; --bg-grad:#fff0f6;
    --text:#2b2b2b; --muted:#6b7280;
    --card:#ffffff; --border:#f4dbe3;
    --col-huong:#ff8fab; --col-thuy:#a5b4fc; --col-lien:#9adbb3;
  }
  body{margin:0;font-family:Inter,system-ui;background:linear-gradient(180deg,var(--bg-grad) 0%, #fff 40%);}
  .wrap{max-width:1200px;margin:28px auto;padding:0 18px}
  .hero{border:1px solid var(--border);border-radius:18px;padding:22px;
        background:linear-gradient(135deg,#fff0f6 0%,#fff 45%,#fff5f0 100%);
        box-shadow:0 12px 28px rgba(255,168,186,.20);}
  .hero h1{margin:0;font-size:30px}
  .subtitle{margin-top:6px;color:var(--muted);font-size:16px}
  .toast{position:fixed;right:16px;bottom:16px;background:#fff;
        border:1px solid var(--border);padding:12px 14px;border-radius:12px;
        box-shadow:0 12px 30px rgba(0,0,0,.12);display:none;font-weight:600}
  .toast.show{display:block;animation:fade .18s ease-out}
  @keyframes fade{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}
  canvas#confetti{position:fixed;inset:0;pointer-events:none}
  td{padding:8px 12px;border:1px solid #eee;cursor:pointer}
  td.daycell.done{background:#ffeef3}
</style>
</head>
<body>
<canvas id="confetti"></canvas>

<div class="wrap">
  <div class="hero">
    <h1>30 NGÃ€Y BYE BYE Má»  Bá»¤NG</h1>
    <div class="subtitle">Äá»«ng chá» Ä‘á»™ng lá»±c má»›i báº¯t Ä‘áº§u. HÃ£y báº¯t Ä‘áº§u Ä‘á»ƒ táº¡o ra Ä‘á»™ng lá»±c. ğŸŒ¸</div>
  </div>

  <!-- Chá»n ngÃ y báº¯t Ä‘áº§u -->
  <div style="margin-top:20px">
    <label>Chá»n thÃ nh viÃªn:</label>
    <select id="whoSelect">
      <option value="Huong">HÆ°Æ¡ng</option>
      <option value="Thuy">ThÃ¹y</option>
      <option value="Lien">LiÃªn</option>
    </select>
    <label>NgÃ y báº¯t Ä‘áº§u:</label>
    <input type="date" id="startDateInput"/>
    <button onclick="saveStart()">LÆ°u ngÃ y báº¯t Ä‘áº§u</button>
    <div id="startSummary"></div>
  </div>

  <!-- Leaderboard -->
  <div style="margin-top:20px" id="leaderboard"></div>

  <!-- Biá»ƒu Ä‘á»“ -->
  <div style="margin:20px 0">
    <canvas id="barChart" height="180"></canvas>
  </div>

  <!-- Báº£ng 30 ngÃ y -->
  <div style="margin-top:20px">
    <table id="daysTable"></table>
  </div>

  <!-- Export / Import -->
  <div style="margin-top:20px">
    <button onclick="exportData()">â¬‡ï¸ Xuáº¥t JSON</button>
    <input type="file" id="importFile" accept="application/json" style="display:none" onchange="importData(event)"/>
    <button onclick="document.getElementById('importFile').click()">â¬†ï¸ Nháº­p JSON</button>
    <button onclick="resetAll()">ğŸ” Reset toÃ n bá»™</button>
  </div>
</div>

<div id="toast" class="toast"></div>

<script>
/* ================== STATE ================== */
const KEY="30days-full-v2";const DAYS=30;
const members=[
  {id:"Huong",name:"HÆ°Æ¡ng",color:"var(--col-huong)"},
  {id:"Thuy",name:"ThÃ¹y",color:"var(--col-thuy)"},
  {id:"Lien",name:"LiÃªn",color:"var(--col-lien)"}
];
function defaultState(){
  return {
    days:Array.from({length:DAYS},()=>({Huong:false,Thuy:false,Lien:false})),
    journal:Array.from({length:DAYS},()=>({Huong:null,Thuy:null,Lien:null})),
    startDate:{Huong:null,Thuy:null,Lien:null},
    milestone:{Huong:{},Thuy:{},Lien:{}}
  };
}
let state=defaultState();
function save(){localStorage.setItem(KEY,JSON.stringify(state));}
function load(){const raw=localStorage.getItem(KEY);if(raw)state=JSON.parse(raw);}
load();

/* ================== CONFETTI ================== */
const confettiCanvas=document.getElementById('confetti');
const cctx=confettiCanvas.getContext('2d');
function sizeCanvas(){confettiCanvas.width=innerWidth;confettiCanvas.height=innerHeight;}
sizeCanvas();addEventListener('resize',sizeCanvas);
let particles=[];
function burst(x,y,emoji="ğŸŒ¸"){
  for(let i=0;i<25;i++){
    particles.push({x,y,vx:(Math.random()-0.5)*6,vy:(Math.random()*-6)-2,
      rot:Math.random()*6,life:60,emoji,spin:(Math.random()-0.5)*0.3,
      size:18+Math.random()*10});
  }
}
(function tick(){cctx.clearRect(0,0,confettiCanvas.width,confettiCanvas.height);
  particles.forEach(p=>{p.life--;p.x+=p.vx;p.vy+=0.18;p.y+=p.vy;p.rot+=p.spin;
    cctx.save();cctx.translate(p.x,p.y);cctx.rotate(p.rot);
    cctx.font=p.size+"px serif";cctx.fillText(p.emoji,0,0);cctx.restore();});
  particles=particles.filter(p=>p.life>0);requestAnimationFrame(tick);
})();

/* ================== TOAST + DING ================== */
const toastEl=document.getElementById('toast');
function toast(msg,ms=2000){toastEl.textContent=msg;toastEl.classList.add('show');setTimeout(()=>toastEl.classList.remove('show'),ms);}
function playDing(){try{const ctx=new (window.AudioContext||window.webkitAudioContext)();const o=ctx.createOscillator(),g=ctx.createGain();o.type="sine";o.frequency.value=880;g.gain.setValueAtTime(0.0001, ctx.currentTime);g.gain.exponentialRampToValueAtTime(0.2, ctx.currentTime+0.02);g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime+0.18);o.connect(g);g.connect(ctx.destination);o.start();o.stop(ctx.currentTime+0.2);}catch{}}

/* ================== MESSAGES ================== */
const MOTIVATION=["Cá»‘ lÃªn!!! ğŸ’ª","Tuyá»‡t vá»i, báº¡n lÃ m Ä‘Æ°á»£c rá»“i! ğŸŒŸ","Giá»¯ vá»¯ng phong Ä‘á»™ nhÃ©! ğŸ”¥","Má»—i ngÃ y má»™t bÆ°á»›c nhá», báº¡n Ä‘ang tiáº¿n bá»™! ğŸš€","Báº¡n máº¡nh máº½ hÆ¡n báº¡n nghÄ©! ğŸ’–"];
function randomMsg(){return MOTIVATION[Math.floor(Math.random()*MOTIVATION.length)];}

/* ================== CHECKIN ================== */
function doToggle(day,id){
  state.days[day][id]=!state.days[day][id];
  save();burst(innerWidth/2, innerHeight/3,"ğŸŒ¸");playDing();toast(randomMsg());
  checkMilestones(id);render();
}

/* ================== START DATE ================== */
function saveStart(){const who=document.getElementById('whoSelect').value;const date=document.getElementById('startDateInput').value;if(!date){toast("Chá»n ngÃ y!");return;}state.startDate[who]=date;save();render();}
function buildStartSummary(){let html="";members.forEach(m=>{html+=`<div>${m.name}: ${state.startDate[m.id]||"â€”"}</div>`});document.getElementById('startSummary').innerHTML=html;}

/* ================== LEADERBOARD ================== */
function totalOf(id){return state.days.reduce((a,d)=>a+(d[id]?1:0),0);}
function streakOf(id){let s=0;for(let i=DAYS-1;i>=0;i--){if(state.days[i][id])s++;else if(s>0)break;}return s;}
function buildLeaderboard(){let html="<h2>ğŸ† Leaderboard</h2>";members.forEach(m=>{html+=`<div><b style="color:${m.color}">${m.name}</b>: ${totalOf(m.id)}/${DAYS} â€¢ ğŸ”¥${streakOf(m.id)}</div>`});document.getElementById('leaderboard').innerHTML=html;}

/* ================== MILESTONES ================== */
const QUOTES=["Ká»· luáº­t Ä‘Æ°a báº¡n tá»›i nÆ¡i Ä‘á»™ng lá»±c khÃ´ng thá»ƒ.","Má»—i ngÃ y má»™t bÆ°á»›c nhá», 30 ngÃ y má»™t bÆ°á»›c ngoáº·t.","Báº¡n khÃ´ng cáº§n nhanh â€“ chá»‰ cáº§n kiÃªn trÃ¬.","CÆ¡ thá»ƒ lÃ  nháº­t kÃ½ cá»§a thÃ³i quen. HÃ£y viáº¿t Ä‘iá»u báº¡n tá»± hÃ o!"];
function checkMilestones(id){const t=totalOf(id);[7,15,30].forEach(m=>{if(t===m&&!state.milestone[id][m]){state.milestone[id][m]=true;save();toast(`${id} Ä‘áº¡t má»‘c ${m} ngÃ y! ${QUOTES[Math.floor(Math.random()*QUOTES.length)]}`,4000);burst(innerWidth/2,innerHeight/3,"âœ¨");}});}

/* ================== JOURNAL (simple demo) ================== */
function openJournal(day,id){const note=prompt(`Nháº­t kÃ½ cá»§a ${id} - NgÃ y ${day+1}`,state.journal[day][id]?.note||"");if(note!==null){state.journal[day][id]={note};save();}}

/* ================== CHART ================== */
let chart;
function buildChart(){const ctx=document.getElementById('barChart');const totals=members.map(m=>totalOf(m.id));if(chart)chart.destroy();chart=new Chart(ctx,{type:'bar',data:{labels:members.map(m=>m.name),datasets:[{data:totals,backgroundColor:['#ff8fab','#a5b4fc','#9adbb3']}]},options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true,suggestedMax:30}}}});}

/* ================== EXPORT / IMPORT ================== */
function exportData(){const blob=new Blob([JSON.stringify(state,null,2)],{type:"application/json"});const url=URL.createObjectURL(blob);const a=document.createElement("a");a.href=url;a.download="30days.json";a.click();URL.revokeObjectURL(url);}
function importData(e){const f=e.target.files[0];if(!f)return;const rd=new FileReader();rd.onload=()=>{try{state=JSON.parse(rd.result);save();render();}catch{alert("File lá»—i")}};rd.readAsText(f);}
function resetAll(){if(confirm("XÃ³a toÃ n bá»™ dá»¯ liá»‡u?")){state=defaultState();save();render();}}

/* ================== RENDER ================== */
const tableEl=document.getElementById('daysTable');
function render(){buildStartSummary();buildLeaderboard();buildChart();const tbody=document.createElement('tbody');for(let d=0;d<DAYS;d++){const tr=document.createElement('tr');tr.innerHTML=`<td><b>NgÃ y ${d+1}</b></td>`;members.forEach(m=>{const td=document.createElement('td');td.textContent=state.days[d][m.id]?"âœ…":"â€”";td.className="daycell"+(state.days[d][m.id]?" done":"");td.onclick=()=>doToggle(d,m.id);td.ondblclick=()=>openJournal(d,m.id);tr.appendChild(td);});tbody.appendChild(tr);}tableEl.innerHTML="";tableEl.appendChild(tbody);}
render();
</script>
</body>
</html>
